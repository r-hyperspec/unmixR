<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="unmixR">
<title> â€¢ unmixR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="unmixR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">unmixR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.339</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/IntroUnmixR.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/ice.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/unmixUnittests.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/vca.html">UNKNOWN TITLE</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-hyperspec/unmixR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-hyperspec/unmixR/blob/HEAD/vignettes/ice.Rmd" class="external-link"><code>vignettes/ice.Rmd</code></a></small>
      <div class="d-none name"><code>ice.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{ICE with unmixR}
%\VignetteKeywords{hyperspectral unmixing, iterative constrained endmembers, ICE}
%\VignetteDepends{rbenchmark}
 -->
<div class="section level2">
<h2 id="ice-with-unmixr">ICE with unmixR<a class="anchor" aria-label="anchor" href="#ice-with-unmixr"></a>
</h2>
<p>Anton Belov, July 25, 2016</p>
<div class="section level3">
<h3 id="algorithm-description">Algorithm Description<a class="anchor" aria-label="anchor" href="#algorithm-description"></a>
</h3>
<p>Iterative constrained endmembers is an iterative cyclic descent algorithm which converges to an optimal solution for the endmembers. Unlike many other algorithms it does not require pure pixels to be present in the scene. The algorithm makes three steps:</p>
<ol style="list-style-type: decimal">
<li>Estimate abundances</li>
<li>Estimate endmembers</li>
<li>Check for convergence</li>
</ol>
</div>
<div class="section level3">
<h3 id="abundances-estimation">Abundances Estimation<a class="anchor" aria-label="anchor" href="#abundances-estimation"></a>
</h3>
<p>The abundances are calculated via quadratic programing. There are two possible situations. First one is that the assumption is correct. In this case vertices inside the simplex are convex combinations of simplex vertices.</p>
<p><span class="math display">\[\sum_{i=1}^{n}a_{i}x_{i}=r\]</span></p>
<p>Where <span class="math inline">\(x_{i}\)</span> is a vertex of a simplex.</p>
<p>A convex combination has following properties</p>
<p><span class="math display">\[\sum_{i=1}^{n}a_{i}=1\]</span> <span class="math display">\[0\leqslant a_{i}\leqslant 1\]</span></p>
<p>A convex combination is also a barycentric one and the coordinates of a point are its barycentric coordinates. To find the coordinates it is enough to solve the following system.</p>
<p><span class="math display">\[\begin{pmatrix}
x_{1} &amp; x_{2} &amp; . &amp; x_{n}\\
y_{1} &amp; y_{2} &amp; . &amp; y_{n}\\
. &amp; . &amp; . &amp; .\\
1 &amp; 1 &amp; . &amp; 1
\end{pmatrix}a = \begin{pmatrix}
x_{r}\\
y_{r}\\
.\\
1
\end{pmatrix}\]</span></p>
<p>Where <span class="math inline">\(a\)</span> is a vector of abundances. The last line constrains a sum of coordinates and also makes the combination unique.</p>
<p>But if there are no pure pixels for each of the endmembers then it is possible that a point <span class="math inline">\(r\)</span> will be outside of the simplex. The barycentric coordinates sum to one but they are not necessarily non-negative. Here are some examples.</p>
<div class="section level5">
<h5 id="point-inside-a-simplex">Point Inside a Simplex<a class="anchor" aria-label="anchor" href="#point-inside-a-simplex"></a>
</h5>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># vertices of a simplex</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span>
<span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="co"># point inside a simplex</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-1-1.png" width="465.984"></p>
<p>Letâ€™s calculate the abundances.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">p</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     a     b     c </span>
<span class="co">## 0.125 0.375 0.500</span></code></pre>
<p>Least squares with non-negativity constraint.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">nnls</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">p</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></code></pre></div>
<pre><code><span class="co">## [1] 0.125 0.375 0.500</span></code></pre>
<p>Ordinary least squares with no constraints. Since the point is inside the simplex they are not required.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">limSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limSolve/man/lsei.html" class="external-link">lsei</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">m</span>, B <span class="op">=</span> <span class="va">p</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">X</span></code></pre></div>
<pre><code><span class="co">##     a     b     c </span>
<span class="co">## 0.125 0.375 0.500</span></code></pre>
<p>All methods find the same solution. But what will happen if the point is not inside the simplex?</p>
</div>
<div class="section level5">
<h5 id="point-outside-a-simplex">Point Outside a Simplex<a class="anchor" aria-label="anchor" href="#point-outside-a-simplex"></a>
</h5>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span>
<span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-5-1.png" width="465.984"></p>
<p>True barycentric coordinates can be found solving the system of linear equations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      a      b      c </span>
<span class="co">##  0.875  0.625 -0.500</span></code></pre>
<p>Least squares with non-negativity constraint.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">nnls</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></code></pre></div>
<pre><code><span class="co">## [1] 0.75 0.25 0.00</span></code></pre>
<p>Now we have to add both constraints to the least squares method. Note that the matrix <code>m</code> is used not <code>m1</code>. Lsei stands for least squares with equality and inequality constraints. It solves <span class="math inline">\(\left \| Ax - b \right \|^{2}\)</span> problem with <span class="math inline">\(Ex=f\)</span> and <span class="math inline">\(Gx\geq h\)</span> constraints.</p>
<p>The abundances sum to one means</p>
<p><span class="math display">\[\begin{pmatrix}
1 &amp; 1 &amp; ... &amp; 1
\end{pmatrix}\begin{pmatrix}
a_{1}\\
a_{2}\\
...\\
a_{n}
\end{pmatrix}=1\]</span></p>
<p>The abundances are non-negative means</p>
<p><span class="math display">\[\begin{pmatrix}
1 &amp; 0 &amp; . &amp; 0\\
0 &amp; 1 &amp; . &amp; 0\\
. &amp; . &amp; . &amp; .\\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}\begin{pmatrix}
a_{1}\\
a_{2}\\
...\\
a_{n}
\end{pmatrix}\geqslant \begin{pmatrix}
0\\
0\\
...\\
0
\end{pmatrix}\]</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">G</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">H</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="fu">limSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limSolve/man/lsei.html" class="external-link">lsei</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">m</span>, B <span class="op">=</span> <span class="va">p</span>, E <span class="op">=</span> <span class="va">E</span>, F <span class="op">=</span> <span class="fl">1</span>, G <span class="op">=</span> <span class="va">G</span>, H <span class="op">=</span> <span class="va">H</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">X</span></code></pre></div>
<pre><code><span class="co">##    a    b    c </span>
<span class="co">## 0.75 0.25 0.00</span></code></pre>
<p>The resulting point is the closest point to <code>p</code> from the simplex. In our case it is (2, 2).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="fu">nnls</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">*</span><span class="fu">nnls</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 2 2</span></code></pre>
<p>In this case the function <code>solve</code> is not able to find correct answer, but the two other methods are successful. Letâ€™s consider another point outside a simplex.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span>
<span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-10-1.png" width="465.984"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       a       b       c </span>
<span class="co">## -0.1875  0.9375  0.2500</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">nnls</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnls/man/nnls.html" class="external-link">nnls</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">p1</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></code></pre></div>
<pre><code><span class="co">## [1] 0.0000000 0.9000000 0.2463415</span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">G</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">H</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">abundances</span> <span class="op">&lt;-</span> <span class="fu">limSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limSolve/man/lsei.html" class="external-link">lsei</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">m</span>, B <span class="op">=</span> <span class="va">p</span>, E <span class="op">=</span> <span class="va">E</span>, F <span class="op">=</span> <span class="fl">1</span>, G <span class="op">=</span> <span class="va">G</span>, H <span class="op">=</span> <span class="va">H</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>
<span class="va">abundances</span></code></pre></div>
<pre><code><span class="co">##   a   b   c </span>
<span class="co">## 0.0 0.9 0.1</span></code></pre>
<p>The resulting point is the closest point to p from the simplex. In our case it is (5.1, 4.7).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op"><a href="https://r-hyperspec.github.io/hyperSpec/reference/Arith.html" class="external-link">%*%</a></span> <span class="va">abundances</span></code></pre></div>
<pre><code><span class="co">##      [,1]</span>
<span class="co">## [1,]  5.1</span>
<span class="co">## [2,]  4.7</span></code></pre>
<p>Only the last method gives the correct answer.</p>
</div>
</div>
<div class="section level3">
<h3 id="endmember-estimation">Endmember Estimation<a class="anchor" aria-label="anchor" href="#endmember-estimation"></a>
</h3>
<p>We assume that pixels are linear combinations of endmembers.</p>
<p><span class="math display">\[Y = MA\]</span></p>
<p><span class="math display">\[A^{T}M^{T} = Y^{T}\]</span></p>
<p>However the matrix <span class="math inline">\(A\)</span> is not square and thus not invertible. To calculate <span class="math inline">\(M\)</span> we will use left inverse matrix</p>
<p><span class="math display">\[(A^{T})_{left}^{-1} = (AA^{T})^{-1} A\]</span></p>
<p><span class="math display">\[AA^{T}M^{T} = AY^{T}\]</span></p>
<p><span class="math display">\[(AA^{T})^{-1}AA^{T}M^{T} = (AA^{T})^{-1}AY^{T}\]</span></p>
<p><span class="math display">\[M^{T} = (AA^{T})^{-1}AY^{T}\]</span></p>
<p>To make the model more resistant to noise in data a regularization parameter is used. Further information about regularization parameter can be found in [1].</p>
<p><span class="math display">\[M^{T} =(AA^{T} + \lambda (I - \frac{11^{T}}{m}))^{-1}AY^{T}\]</span></p>
</div>
<div class="section level3">
<h3 id="laser-dataset-example">Laser Dataset Example<a class="anchor" aria-label="anchor" href="#laser-dataset-example"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-hyperspec.github.io/hyperSpec/" class="external-link">hyperSpec</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Package hyperSpec, version 0.100.0</span>
<span class="co">## </span>
<span class="co">## To get started, try</span>
<span class="co">##    vignette ("hyperspec")</span>
<span class="co">##    package?hyperSpec </span>
<span class="co">##    vignette (package = "hyperSpec")</span>
<span class="co">## </span>
<span class="co">## If you use this package please cite it appropriately.</span>
<span class="co">##    citation("hyperSpec")</span>
<span class="co">## will give you the correct reference.</span>
<span class="co">## </span>
<span class="co">## The project homepage is http://hyperspec.r-forge.r-project.org</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-hyperspec.github.io/unmixr/" class="external-link">unmixR</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required package: MASS</span></code></pre>
<pre><code><span class="co">## Loading required package: nnls</span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">laser</span><span class="op">)</span>
    <span class="va">Ud</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">u</span>
    <span class="va">reducedData</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://r-hyperspec.github.io/hyperSpec/reference/Arith.html" class="external-link">%*%</a></span> <span class="va">Ud</span>
    <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span>data <span class="op">=</span>  <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,
      geom <span class="op">=</span> <span class="st">"point"</span>, main <span class="op">=</span> <span class="st">"laser data reduced to dimensionality of 2"</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-15-1.png" width="465.984"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span><span class="op">)</span>
    <span class="va">endm</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">endmembers</span>
    <span class="va">reducedEndmembers</span> <span class="op">&lt;-</span> <span class="va">endm</span> <span class="op"><a href="https://r-hyperspec.github.io/hyperSpec/reference/Arith.html" class="external-link">%*%</a></span> <span class="va">Ud</span>
    <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span>  <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
        alpha <span class="op">=</span> <span class="fl">0.05</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Ice simplex"</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-16-1.png" width="465.984"></p>
</div>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<div class="section level4">
<h4 id="regularization-parameter">Regularization Parameter<a class="anchor" aria-label="anchor" href="#regularization-parameter"></a>
</h4>
<p>This parameter penalizes the model for the simplex size. The regularization technique makes the model less affected by noise in data. The higher the value the bigger the penalty so when it is equal to 1 the simplex shrinks to a single point.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span>
    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">0</span><span class="op">)</span>
    <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simplices</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"muValue"</span><span class="op">)</span>
    <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="va">simplices</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">m</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, mu <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">endmembers</span>
        <span class="va">reducedEndmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span> <span class="op"><a href="https://r-hyperspec.github.io/hyperSpec/reference/Arith.html" class="external-link">%*%</a></span> <span class="va">Ud</span><span class="op">)</span>
        <span class="va">reducedEndmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">reducedEndmembers</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"muValue"</span><span class="op">)</span>
        <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">simplices</span>, <span class="va">reducedEndmembers</span><span class="op">)</span>
    <span class="op">}</span></code></pre></div>
<p>The dependence of the simplex size on the regularization parameter can be seen on the following picture. Since the value is usually very small we consider values equal to powers of 10.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simplices</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span>,
        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, colour <span class="op">=</span> <span class="va">muValue</span>, group <span class="op">=</span> <span class="va">muValue</span><span class="op">)</span>,
        alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>, trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Dependence on mu"</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-18-1.png" width="465.984"></p>
<p>As it was already, stated a very small value is enough to prevent the simplex from being unreasonably large. Here the grey triangle corresponds to a simplex computed without the penalty (mu = 0).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simplices</span>,
        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, colour <span class="op">=</span> <span class="va">muValue</span>, group <span class="op">=</span> <span class="va">muValue</span><span class="op">)</span>,
        alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>, trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Dependence on mu"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: Transformation introduced infinite values in discrete y-axis</span></code></pre>
<p><img src="ice_files/figure-html/unnamed-chunk-19-1.png" width="465.984"></p>
</div>
<div class="section level4">
<h4 id="tolerance-ratio">Tolerance Ratio<a class="anchor" aria-label="anchor" href="#tolerance-ratio"></a>
</h4>
<p>The tolerance ratio determines the number of iterations. The algorithm asymptotically approaches the solution and higher values of the parameter mean that the result will be closer to the optimal one and will require more iterations.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="fl">0.999</span>, <span class="fl">0.9999</span>, <span class="fl">0.99999</span><span class="op">)</span>
    <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simplices</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"tauValue"</span><span class="op">)</span>
    <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="va">simplices</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">t</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">endmembers</span>
        <span class="va">reducedEndmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span> <span class="op"><a href="https://r-hyperspec.github.io/hyperSpec/reference/Arith.html" class="external-link">%*%</a></span> <span class="va">Ud</span><span class="op">)</span>
        <span class="va">reducedEndmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">reducedEndmembers</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">reducedEndmembers</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"tauValue"</span><span class="op">)</span>
        <span class="va">simplices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">simplices</span>, <span class="va">reducedEndmembers</span><span class="op">)</span>
    <span class="op">}</span></code></pre></div>
<p>The value of tau is usually extremely close to 1 and the following plot shows it very well. Four simplices corresponding to lower values differ very much. Simplices which correspond to 0.9999 and 0.99999 differ very little. That means that the algorithm finds the optimal solution having the value of tau not less than 0.999.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-hyperspec.github.io/hyperSpec/reference/asdataframe.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">reducedData</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simplices</span>,
        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, colour <span class="op">=</span> <span class="va">tauValue</span>, group <span class="op">=</span> <span class="va">tauValue</span><span class="op">)</span>,
        alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, values <span class="op">=</span> <span class="va">t</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Dependence on tau"</span><span class="op">)</span></code></pre></div>
<p><img src="ice_files/figure-html/unnamed-chunk-21-1.png" width="465.984"></p>
<p>As the number of iterations grows so does the calculation time.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R">    <span class="va">tst</span> <span class="op">&lt;-</span> <span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rbenchmark/man/benchmark.html" class="external-link">benchmark</a></span><span class="op">(</span>
      <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>,
      <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,
      <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="fl">0.999</span><span class="op">)</span>,
      <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="fl">0.9999</span><span class="op">)</span>,
      <span class="fu"><a href="../reference/ice.html">ice</a></span><span class="op">(</span><span class="va">laser</span>, <span class="fl">3</span>, t <span class="op">=</span> <span class="fl">0.99999</span><span class="op">)</span><span class="op">)</span>
    <span class="va">tst</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##                         test replications elapsed relative user.self</span>
<span class="co">## 1     ice(laser, 3, t = 0.9)          100   1.806    1.000     1.805</span>
<span class="co">## 2    ice(laser, 3, t = 0.99)          100   2.986    1.653     2.985</span>
<span class="co">## 3   ice(laser, 3, t = 0.999)          100   3.465    1.919     3.465</span>
<span class="co">## 4  ice(laser, 3, t = 0.9999)          100   3.444    1.907     3.444</span>
<span class="co">## 5 ice(laser, 3, t = 0.99999)          100   3.520    1.949     3.520</span></code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anton Belov, Conor McManus, Claudia Beleites, Bryan A. Hanson, Simon Fuller.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
